(()=>{"use strict";var e,t,n=document.querySelector("#avatar-popup"),r=document.querySelector("#profile-popup"),o=document.querySelector("#card-popup"),c=document.querySelector("#image-popup"),i=document.querySelector("#confirm-popup"),u=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),l=document.querySelector(".profile__edit-avatar"),s=document.querySelector("#btn-avatar-submit"),d=document.querySelector("#btn-profile-submit"),f=document.querySelector("#btn-card-submit"),m=document.querySelector("#btn-confirm-submit"),v=document.querySelector("#form-profile"),p=document.querySelector("#form-card"),y=document.querySelector("#form-avatar"),h=document.querySelector("#form-confirm"),_=document.querySelector("#firstname"),S=document.querySelector("#activity"),b=document.querySelector("#url-avatar"),q=document.querySelector("#title"),g=document.querySelector("#url"),E=document.querySelector(".profile__info-name"),L=document.querySelector(".profile__info-activity"),k=document.querySelector(".profile__avatar"),C=document.querySelector(".elements"),A=document.querySelector("#card-template").content,x=c.querySelector(".popup__pic"),T=c.querySelector(".popup__image-caption"),U=document.body,w=document.querySelectorAll(".popup"),D={formSelector:".form",inputSelector:".form__field",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__field_error",errorClass:"form__input-error_active"},j={baseUrl:"https://nomoreparties.co/v1/plus-cohort-13",headers:{authorization:"3bc54813-3658-4b8a-b68f-e51cf1301e4a","Content-Type":"application/json"}};function B(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}function O(e,t){x.src=t,x.alt=e,T.textContent=e,z(c)}function P(e){var t,n=e.target.closest(".element"),r=n.querySelector(".element__like-count");e.target.classList.contains("element__like_active")?function(e){return fetch("".concat(j.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:j.headers}).then(B)}(n.id).then((function(t){r.textContent=t.likes.length,e.target.classList.toggle("element__like_active")})).catch((function(e){console.log(e)})):(t=n.id,fetch("".concat(j.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:j.headers}).then(B)).then((function(t){r.textContent=t.likes.length,e.target.classList.toggle("element__like_active")})).catch((function(e){console.log(e)}))}function N(t){e=t.target.closest(".element"),z(i)}function I(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=A.querySelector(".element").cloneNode(!0),u=i.querySelector(".element__pic"),a=i.querySelector(".element__reset"),l=i.querySelector(".element__like");return i.id=r,u.src=t,u.alt=e,i.querySelector(".element__text").textContent=e,u.addEventListener("click",(function(){return O(e,t)})),l.addEventListener("click",P),i.querySelector(".element__like-count").textContent=n,c&&l.classList.add("element__like_active"),o&&(a.classList.add("element__reset_active"),a.addEventListener("click",N)),i}function J(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];C.prepend(I(e,t,n,r,o,c))}function H(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохрнить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.value=e?r:n}function M(e){"Escape"===e.key&&(e.preventDefault(),w.forEach($))}function z(e){e.classList.add("popup_opened"),U.addEventListener("keydown",M)}function $(e){e.classList.remove("popup_opened"),U.removeEventListener("keydown",M)}function F(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.classList.remove(r),o.textContent=""}function G(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",!0))}function K(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){F(t,n,e.inputErrorClass,e.errorClass)})),G(n,r,e.inactiveButtonClass)}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}w.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&$(e),t.target.classList.contains("popup__close")&&$(e)}))})),Promise.all([fetch("".concat(j.baseUrl,"/users/me"),{headers:j.headers}).then(B),fetch("".concat(j.baseUrl,"/cards"),{headers:j.headers}).then(B)]).then((function(e){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],i=!0,u=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(u)throw o}}return c}}(n,r)||function(e,t){if(e){if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],i=o[1];k.src=c.avatar,E.textContent=c.name,L.textContent=c.about,t=c._id,i.forEach((function(e){var n=e.owner._id===t,r=e.likes.some((function(e){return e._id===t}));J(e.name,e.link,e.likes.length,e._id,n,r)}))})).catch((function(e){return console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,r,o,c){var i=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);G(i,u,r),i.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,r){t.validity.valid?F(e,t,n,r):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=n,c.classList.add(o)}(e,t,t.validationMessage,n,r)}(e,t,o,c),G(i,u,r)}))}))}(t,e.inputSelector,e.submitButtonSelector,e.inactiveButtonClass,e.inputErrorClass,e.errorClass)}))}(D),u.addEventListener("click",(function(){_.value=E.textContent,S.value=L.textContent,K(D,r),z(r)})),a.addEventListener("click",(function(){p.reset(),K(D,o),z(o)})),l.addEventListener("click",(function(){y.reset(),K(D,n),z(n)})),v.addEventListener("submit",(function(e){e.preventDefault(),H(!0,d),function(e,t){return fetch("".concat(j.baseUrl,"/users/me"),{method:"PATCH",headers:j.headers,body:JSON.stringify({name:e,about:t})}).then(B)}(_.value,S.value).then((function(){E.textContent=_.value,L.textContent=S.value,$(r)})).catch((function(e){return console.log(e)})).finally((function(){return setTimeout((function(){return H(!1,d)}),1e3)}))})),p.addEventListener("submit",(function(e){e.preventDefault(),H(!0,f),function(e,t){return fetch("".concat(j.baseUrl,"/cards"),{method:"POST",headers:j.headers,body:JSON.stringify({name:e,link:t})}).then(B)}(q.value,g.value).then((function(e){J(e.name,e.link,e.likes.length,e._id,e.owner._id),$(o)})).catch((function(e){return console.log(e)})).finally((function(){return setTimeout((function(){return H(!1,f,"Создать")}),1e3)}))})),y.addEventListener("submit",(function(e){var t;e.preventDefault(),H(!0,s),(t=b.value,fetch("".concat(j.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:j.headers,body:JSON.stringify({avatar:t})}).then(B)).then((function(){k.src=b.value,$(n)})).catch((function(e){return console.log(e)})).finally((function(){return setTimeout((function(){return H(!1,s)}),1e3)}))})),h.addEventListener("submit",(function(){var t;H(!0,m,null,"Удаление..."),(t=e.id,fetch("".concat(j.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:j.headers}).then(B)).then((function(){e.remove(),$(i)})).catch((function(e){return console.log(e)})).finally((function(){return setTimeout((function(){return H(!1,m,"Да")}),1e3)}))}))})();